<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Dashboard | Portal de Clientes | Intelite AI</title>

    <meta name="robots" content="noindex, nofollow">

    <link rel="icon" href="/assets/images/diamante-1.png">

    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="/css/tailwind.config.js"></script>
    <link rel="stylesheet" href="/css/base.css">

    <style>
        .sidebar {
            transition: transform 0.3s ease;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }
        .nav-item {
            transition: all 0.2s;
        }
        .nav-item:hover, .nav-item.active {
            background-color: #f0f7ff;
            color: #006de7;
        }
        .nav-item.active {
            border-left: 3px solid #006de7;
        }
        .metric-card {
            transition: all 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body class="antialiased selection:bg-brand-blue selection:text-white font-sans bg-[#f5f7fa]">
    <div class="bg-noise"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-white border-r border-gray-200 z-40 flex flex-col">
        <!-- Logo -->
        <div class="p-6 border-b border-gray-100">
            <a href="/" class="flex items-center gap-2">
                <img src="/assets/images/logo1200.png" alt="Intelite AI" class="h-8">
            </a>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 p-4 space-y-1">
            <a href="dashboard.html" class="nav-item active flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 font-medium">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                Dashboard
            </a>
            <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 font-medium">
                <i data-lucide="phone" class="w-5 h-5"></i>
                Agente de Voz
            </a>
            <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 font-medium">
                <i data-lucide="message-circle" class="w-5 h-5"></i>
                Chatbot
            </a>
            <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 font-medium">
                <i data-lucide="workflow" class="w-5 h-5"></i>
                Automatizaciones
            </a>
            <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 font-medium">
                <i data-lucide="file-text" class="w-5 h-5"></i>
                Transcripciones
            </a>
            <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 font-medium">
                <i data-lucide="credit-card" class="w-5 h-5"></i>
                Facturacion
            </a>
            <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 rounded-xl text-gray-700 font-medium">
                <i data-lucide="settings" class="w-5 h-5"></i>
                Configuracion
            </a>
        </nav>

        <!-- User Info -->
        <div class="p-4 border-t border-gray-100">
            <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                <div class="w-10 h-10 bg-brand-blue rounded-full flex items-center justify-center text-white font-semibold">
                    <span id="user-initials">ED</span>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate" id="user-name">Empresa Demo</p>
                    <p class="text-xs text-gray-500 truncate" id="user-email">demo@inteliteai.com</p>
                </div>
                <button onclick="logout()" class="text-gray-400 hover:text-red-500" title="Cerrar sesion">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <header class="md:hidden fixed top-0 left-0 right-0 bg-white border-b border-gray-200 z-30 px-4 py-3 flex items-center justify-between">
        <button onclick="toggleSidebar()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
            <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
        <img src="/assets/images/logo1200.png" alt="Intelite AI" class="h-6">
        <button onclick="logout()" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
            <i data-lucide="log-out" class="w-6 h-6"></i>
        </button>
    </header>

    <!-- Mobile Overlay -->
    <div id="sidebar-overlay" class="md:hidden fixed inset-0 bg-black/50 z-30 hidden" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <main class="md:ml-64 min-h-screen pt-16 md:pt-0">
        <div class="p-6 md:p-8">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-2xl md:text-3xl font-semibold text-gray-900">Dashboard</h1>
                <p class="text-gray-500 mt-1">Bienvenido, <span id="welcome-name">Empresa Demo</span></p>
            </div>

            <!-- Date Range Selector -->
            <div class="flex flex-col sm:flex-row gap-4 mb-8">
                <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-xl border border-gray-200">
                    <i data-lucide="calendar" class="w-5 h-5 text-gray-400"></i>
                    <select id="date-range" class="bg-transparent border-none text-gray-700 font-medium focus:outline-none">
                        <option value="7">Ultimos 7 dias</option>
                        <option value="30" selected>Ultimos 30 dias</option>
                        <option value="90">Ultimos 90 dias</option>
                    </select>
                </div>
                <button onclick="refreshData()" class="flex items-center gap-2 bg-white px-4 py-2 rounded-xl border border-gray-200 text-gray-700 hover:bg-gray-50">
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                    Actualizar
                </button>
            </div>

            <!-- Metrics Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="metric-card bg-white p-6 rounded-2xl border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i data-lucide="phone-incoming" class="w-6 h-6 text-blue-600"></i>
                        </div>
                        <span class="text-xs font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">+12%</span>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="metric-llamadas">247</p>
                    <p class="text-sm text-gray-500 mt-1">Llamadas atendidas</p>
                </div>

                <div class="metric-card bg-white p-6 rounded-2xl border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i data-lucide="calendar-check" class="w-6 h-6 text-purple-600"></i>
                        </div>
                        <span class="text-xs font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">+8%</span>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="metric-citas">89</p>
                    <p class="text-sm text-gray-500 mt-1">Citas agendadas</p>
                </div>

                <div class="metric-card bg-white p-6 rounded-2xl border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                            <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                        </div>
                        <span class="text-xs font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">92%</span>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="metric-resolucion">92%</p>
                    <p class="text-sm text-gray-500 mt-1">Tasa resolucion</p>
                </div>

                <div class="metric-card bg-white p-6 rounded-2xl border border-gray-100">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                            <i data-lucide="clock" class="w-6 h-6 text-orange-600"></i>
                        </div>
                        <span class="text-xs font-medium text-blue-600 bg-blue-100 px-2 py-1 rounded-full">Media</span>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="metric-duracion">2:34</p>
                    <p class="text-sm text-gray-500 mt-1">Duracion media</p>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Calls Chart -->
                <div class="bg-white p-6 rounded-2xl border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-semibold text-gray-900">Llamadas por dia</h3>
                        <div class="flex items-center gap-4 text-sm">
                            <span class="flex items-center gap-1">
                                <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                                Atendidas
                            </span>
                            <span class="flex items-center gap-1">
                                <span class="w-3 h-3 bg-gray-300 rounded-full"></span>
                                Perdidas
                            </span>
                        </div>
                    </div>
                    <div style="position: relative; height: 200px; width: 100%;">
                        <canvas id="callsChart"></canvas>
                    </div>
                </div>

                <!-- Distribution Chart -->
                <div class="bg-white p-6 rounded-2xl border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-semibold text-gray-900">Tipo de consultas</h3>
                    </div>
                    <div style="position: relative; height: 200px; width: 100%;">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Calls Table -->
            <div class="bg-white rounded-2xl border border-gray-100 overflow-hidden">
                <div class="p-6 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900">Ultimas llamadas</h3>
                        <a href="#" class="text-sm text-brand-blue hover:underline">Ver todas</a>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefono</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duracion</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100" id="calls-table">
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Check auth
        function checkAuth() {
            const token = localStorage.getItem('auth_token') || sessionStorage.getItem('auth_token');
            if (!token) {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        // Logout
        function logout() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('cliente_id');
            localStorage.removeItem('cliente_nombre');
            localStorage.removeItem('cliente_email');
            sessionStorage.removeItem('auth_token');
            sessionStorage.removeItem('cliente_id');
            sessionStorage.removeItem('cliente_nombre');
            sessionStorage.removeItem('cliente_email');
            window.location.href = 'login.html';
        }

        // Toggle sidebar on mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden');
        }

        // Load user info
        function loadUserInfo() {
            const nombre = localStorage.getItem('cliente_nombre') || sessionStorage.getItem('cliente_nombre') || 'Cliente';
            const email = localStorage.getItem('cliente_email') || sessionStorage.getItem('cliente_email') || '';

            document.getElementById('user-name').textContent = nombre;
            document.getElementById('user-email').textContent = email;
            document.getElementById('welcome-name').textContent = nombre;

            // Generate initials
            const initials = nombre.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            document.getElementById('user-initials').textContent = initials;
        }

        // Generate demo data for calls table
        function generateCallsTable() {
            const calls = [
                { date: 'Hoy, 14:32', phone: '+34 612 XXX XXX', duration: '3:45', type: 'Cita', status: 'completed' },
                { date: 'Hoy, 12:15', phone: '+34 698 XXX XXX', duration: '1:23', type: 'Consulta', status: 'completed' },
                { date: 'Hoy, 10:08', phone: '+34 655 XXX XXX', duration: '2:56', type: 'Cita', status: 'completed' },
                { date: 'Ayer, 18:42', phone: '+34 622 XXX XXX', duration: '0:45', type: 'Info', status: 'transferred' },
                { date: 'Ayer, 16:20', phone: '+34 677 XXX XXX', duration: '4:12', type: 'Cita', status: 'completed' },
            ];

            const statusBadges = {
                completed: '<span class="px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded-full">Completada</span>',
                transferred: '<span class="px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 rounded-full">Transferida</span>',
                missed: '<span class="px-2 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-full">Perdida</span>'
            };

            const tbody = document.getElementById('calls-table');
            tbody.innerHTML = calls.map(call => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${call.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${call.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${call.duration}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${call.type}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${statusBadges[call.status]}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-brand-blue hover:underline text-sm">Ver transcripcion</button>
                    </td>
                </tr>
            `).join('');
        }

        // Initialize charts
        function initCharts() {
            // Calls per day chart
            const callsCtx = document.getElementById('callsChart').getContext('2d');
            new Chart(callsCtx, {
                type: 'bar',
                data: {
                    labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
                    datasets: [
                        {
                            label: 'Atendidas',
                            data: [32, 28, 35, 42, 38, 15, 8],
                            backgroundColor: '#006de7',
                            borderRadius: 6
                        },
                        {
                            label: 'Perdidas',
                            data: [3, 5, 2, 4, 3, 1, 0],
                            backgroundColor: '#e5e7eb',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { stacked: true, grid: { display: false } },
                        y: { stacked: true, beginAtZero: true }
                    }
                }
            });

            // Distribution chart
            const distCtx = document.getElementById('distributionChart').getContext('2d');
            new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Citas', 'Consultas', 'Soporte', 'Otros'],
                    datasets: [{
                        data: [45, 30, 15, 10],
                        backgroundColor: ['#006de7', '#8b5cf6', '#f59e0b', '#e5e7eb'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 20 }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // Refresh data
        function refreshData() {
            // In production, this would fetch from n8n webhook
            // For now, just show a loading state
            const btn = event.target;
            btn.innerHTML = '<i data-lucide="refresh-cw" class="w-5 h-5 animate-spin"></i> Actualizando...';

            setTimeout(() => {
                btn.innerHTML = '<i data-lucide="refresh-cw" class="w-5 h-5"></i> Actualizar';
                lucide.createIcons();
            }, 1000);
        }

        // Initialize
        if (checkAuth()) {
            loadUserInfo();
            generateCallsTable();
            initCharts();
        }
    </script>

    <script>lucide.createIcons();</script>
</body>
</html>
